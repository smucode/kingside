var require=function(a,b){var c=require.resolve(a,b||"/"),d=require.modules[c];if(!d)throw new Error("Failed to resolve module "+a+", tried "+c);var e=d._cached?d._cached:d();return e};require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(a,b){function g(a){if(require.modules[a])return a;for(var b=0;b<require.extensions.length;b++){var c=require.extensions[b];if(require.modules[a+c])return a+c}}function h(a){a=a.replace(/\/+$/,"");var b=a+"/package.json";if(require.modules[b]){var d=require.modules[b](),e=d.browserify;if(typeof e=="object"&&e.main){var f=g(c.resolve(a,e.main));if(f)return f}else if(typeof e=="string"){var f=g(c.resolve(a,e));if(f)return f}else if(d.main){var f=g(c.resolve(a,d.main));if(f)return f}}return g(a+"/index")}function i(a,b){var c=j(b);for(var d=0;d<c.length;d++){var e=c[d],f=g(e+"/"+a);if(f)return f;var i=h(e+"/"+a);if(i)return i}var f=g(a);if(f)return f}function j(a){var b;a==="/"?b=[""]:b=c.normalize(a).split("/");var d=[];for(var e=b.length-1;e>=0;e--){if(b[e]==="node_modules")continue;var f=b.slice(0,e+1).join("/")+"/node_modules";d.push(f)}return d}b||(b="/");if(require._core[a])return a;var c=require.modules.path(),d=b||".";if(a.match(/^(?:\.\.?\/|\/)/)){var e=g(c.resolve(d,a))||h(c.resolve(d,a));if(e)return e}var f=i(a,d);if(f)return f;throw new Error("Cannot find module '"+a+"'")}}(),require.alias=function(a,b){var c=require.modules.path(),d=null;try{d=require.resolve(a+"/package.json","/")}catch(e){d=require.resolve(a,"/")}var f=c.dirname(d),g=Object_keys(require.modules);for(var h=0;h<g.length;h++){var i=g[h];if(i.slice(0,f.length+1)===f+"/"){var j=i.slice(f.length);require.modules[b+j]=require.modules[f+j]}else i===f&&(require.modules[b]=require.modules[f])}},require.define=function(a,b){var c=require._core[a]?"":require.modules.path().dirname(a),d=function(a){return require(a,c)};d.resolve=function(a){return require.resolve(a,c)},d.modules=require.modules,d.define=require.define;var e={exports:{}};require.modules[a]=function(){return require.modules[a]._cached=e.exports,b.call(e.exports,d,e,e.exports,c,a),require.modules[a]._cached=e.exports,e.exports}};var Object_keys=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(a){setTimeout(a,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(a){if(a==="evals")return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.define("path",function(a,b,c,d,e){function f(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}function g(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var h=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){var a="",b=!1;for(var c=arguments.length;c>=-1&&!b;c--){var d=c>=0?arguments[c]:process.cwd();if(typeof d!="string"||!d)continue;a=d+"/"+a,b=d.charAt(0)==="/"}return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b=a.charAt(0)==="/",c=a.slice(-1)==="/";return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),!a&&!b&&(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(f(a,function(a,b){return a&&typeof a=="string"}).join("/"))},c.dirname=function(a){var b=h.exec(a)[1]||"",c=!1;return b?b.length===1||c&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=h.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return h.exec(a)[3]||""}}),require.define("/node_modules/underscore/package.json",function(a,b,c,d,e){b.exports={main:"underscore.js"}}),require.define("/node_modules/underscore/underscore.js",function(a,b,c,d,e){((function(){function C(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(y.isFunction(a.isEqual))return a.isEqual(b);if(y.isFunction(b.isEqual))return b.isEqual(a);var d=k.call(a);if(d!=k.call(b))return!1;switch(d){case"[object String]":return String(a)==String(b);case"[object Number]":return a=+a,b=+b,a!=a?b!=b:a==0?1/a==1/b:a==b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&C(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(l.call(a,h)){f++;if(!(g=l.call(b,h)&&C(a[h],b[h],c)))break}if(g){for(h in b)if(l.call(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.slice,j=f.unshift,k=g.toString,l=g.hasOwnProperty,m=f.forEach,n=f.map,o=f.reduce,p=f.reduceRight,q=f.filter,r=f.every,s=f.some,t=f.indexOf,u=f.lastIndexOf,v=Array.isArray,w=Object.keys,x=h.bind,y=function(a){return new E(a)};typeof c!="undefined"?(typeof b!="undefined"&&b.exports&&(c=b.exports=y),c._=y):typeof define=="function"&&define.amd?define("underscore",function(){return y}):a._=y,y.VERSION="1.2.2";var z=y.each=y.forEach=function(a,b,c){if(a==null)return;if(m&&a.forEach===m)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;d<f;d++)if(d in a&&b.call(c,a[d],d,a)===e)return}else for(var g in a)if(l.call(a,g)&&b.call(c,a[g],g,a)===e)return};y.map=function(a,b,c){var d=[];return a==null?d:n&&a.map===n?a.map(b,c):(z(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},y.reduce=y.foldl=y.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(o&&a.reduce===o)return d&&(b=y.bind(b,d)),e?a.reduce(b,c):a.reduce(b);z(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},y.reduceRight=y.foldr=function(a,b,c,d){a==null&&(a=[]);if(p&&a.reduceRight===p)return d&&(b=y.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);var e=(y.isArray(a)?a.slice():y.toArray(a)).reverse();return y.reduce(e,b,c,d)},y.find=y.detect=function(a,b,c){var d;return A(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},y.filter=y.select=function(a,b,c){var d=[];return a==null?d:q&&a.filter===q?a.filter(b,c):(z(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},y.reject=function(a,b,c){var d=[];return a==null?d:(z(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},y.every=y.all=function(a,b,c){var d=!0;return a==null?d:r&&a.every===r?a.every(b,c):(z(a,function(a,f,g){if(!(d=d&&b.call(c,a,f,g)))return e}),d)};var A=y.some=y.any=function(a,b,c){b=b||y.identity;var d=!1;return a==null?d:s&&a.some===s?a.some(b,c):(z(a,function(a,f,g){if(d||(d=b.call(c,a,f,g)))return e}),!!d)};y.include=y.contains=function(a,b){var c=!1;return a==null?c:t&&a.indexOf===t?a.indexOf(b)!=-1:(c=A(a,function(a){return a===b}),c)},y.invoke=function(a,b){var c=i.call(arguments,2);return y.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},y.pluck=function(a,b){return y.map(a,function(a){return a[b]})},y.max=function(a,b,c){if(!b&&y.isArray(a))return Math.max.apply(Math,a);if(!b&&y.isEmpty(a))return-Infinity;var d={computed:-Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},y.min=function(a,b,c){if(!b&&y.isArray(a))return Math.min.apply(Math,a);if(!b&&y.isEmpty(a))return Infinity;var d={computed:Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},y.shuffle=function(a){var b=[],c;return z(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},y.sortBy=function(a,b,c){return y.pluck(y.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},y.groupBy=function(a,b){var c={},d=y.isFunction(b)?b:function(a){return a[b]};return z(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},y.sortedIndex=function(a,b,c){c||(c=y.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},y.toArray=function(a){return a?a.toArray?a.toArray():y.isArray(a)?i.call(a):y.isArguments(a)?i.call(a):y.values(a):[]},y.size=function(a){return y.toArray(a).length},y.first=y.head=function(a,b,c){return b!=null&&!c?i.call(a,0,b):a[0]},y.initial=function(a,b,c){return i.call(a,0,a.length-(b==null||c?1:b))},y.last=function(a,b,c){return b!=null&&!c?i.call(a,Math.max(a.length-b,0)):a[a.length-1]},y.rest=y.tail=function(a,b,c){return i.call(a,b==null||c?1:b)},y.compact=function(a){return y.filter(a,function(a){return!!a})},y.flatten=function(a,b){return y.reduce(a,function(a,c){return y.isArray(c)?a.concat(b?c:y.flatten(c)):(a[a.length]=c,a)},[])},y.without=function(a){return y.difference(a,i.call(arguments,1))},y.uniq=y.unique=function(a,b,c){var d=c?y.map(a,c):a,e=[];return y.reduce(d,function(c,d,f){if(0==f||(b===!0?y.last(c)!=d:!y.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},y.union=function(){return y.uniq(y.flatten(arguments,!0))},y.intersection=y.intersect=function(a){var b=i.call(arguments,1);return y.filter(y.uniq(a),function(a){return y.every(b,function(b){return y.indexOf(b,a)>=0})})},y.difference=function(a,b){return y.filter(a,function(a){return!y.include(b,a)})},y.zip=function(){var a=i.call(arguments),b=y.max(y.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=y.pluck(a,""+d);return c},y.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=y.sortedIndex(a,b),a[d]===b?d:-1;if(t&&a.indexOf===t)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},y.lastIndexOf=function(a,b){if(a==null)return-1;if(u&&a.lastIndexOf===u)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},y.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var B=function(){};y.bind=function(b,c){var d,e;if(b.bind===x&&x)return x.apply(b,i.call(arguments,1));if(!y.isFunction(b))throw new TypeError;return e=i.call(arguments,2),d=function(){if(this instanceof d){B.prototype=b.prototype;var a=new B,f=b.apply(a,e.concat(i.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(i.call(arguments)))}},y.bindAll=function(a){var b=i.call(arguments,1);return b.length==0&&(b=y.functions(a)),z(b,function(b){a[b]=y.bind(a[b],a)}),a},y.memoize=function(a,b){var c={};return b||(b=y.identity),function(){var d=b.apply(this,arguments);return l.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},y.delay=function(a,b){var c=i.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},y.defer=function(a){return y.delay.apply(y,[a,1].concat(i.call(arguments,1)))},y.throttle=function(a,b){var c,d,e,f,g,h=y.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},y.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},y.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},y.wrap=function(a,b){return function(){var c=[a].concat(i.call(arguments));return b.apply(this,c)}},y.compose=function(){var a=i.call(arguments);return function(){var b=i.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},y.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},y.keys=w||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)l.call(a,c)&&(b[b.length]=c);return b},y.values=function(a){return y.map(a,y.identity)},y.functions=y.methods=function(a){var b=[];for(var c in a)y.isFunction(a[c])&&b.push(c);return b.sort()},y.extend=function(a){return z(i.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},y.defaults=function(a){return z(i.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},y.clone=function(a){return y.isObject(a)?y.isArray(a)?a.slice():y.extend({},a):a},y.tap=function(a,b){return b(a),a},y.isEqual=function(a,b){return C(a,b,[])},y.isEmpty=function(a){if(y.isArray(a)||y.isString(a))return a.length===0;for(var b in a)if(l.call(a,b))return!1;return!0},y.isElement=function(a){return!!a&&a.nodeType==1},y.isArray=v||function(a){return k.call(a)=="[object Array]"},y.isObject=function(a){return a===Object(a)},k.call(arguments)=="[object Arguments]"?y.isArguments=function(a){return k.call(a)=="[object Arguments]"}:y.isArguments=function(a){return!!a&&!!l.call(a,"callee")},y.isFunction=function(a){return k.call(a)=="[object Function]"},y.isString=function(a){return k.call(a)=="[object String]"},y.isNumber=function(a){return k.call(a)=="[object Number]"},y.isNaN=function(a){return a!==a},y.isBoolean=function(a){return a===!0||a===!1||k.call(a)=="[object Boolean]"},y.isDate=function(a){return k.call(a)=="[object Date]"},y.isRegExp=function(a){return k.call(a)=="[object RegExp]"},y.isNull=function(a){return a===null},y.isUndefined=function(a){return a===void 0},y.noConflict=function(){return a._=d,this},y.identity=function(a){return a},y.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},y.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},y.mixin=function(a){z(y.functions(a),function(b){G(b,y[b]=a[b])})};var D=0;y.uniqueId=function(a){var b=D++;return a?a+b:b},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},y.template=function(a,b){var c=y.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+"),'"}).replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,y):function(a){return e(a,y)}};var E=function(a){this._wrapped=a};y.prototype=E.prototype;var F=function(a,b){return b?y(a).chain():a},G=function(a,b){E.prototype[a]=function(){var a=i.call(arguments);return j.call(a,this._wrapped),F(b.apply(y,a),this._chain)}};y.mixin(y),z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];E.prototype[a]=function(){return b.apply(this._wrapped,arguments),F(this._wrapped,this._chain)}}),z(["concat","join","slice"],function(a){var b=f[a];E.prototype[a]=function(){return F(b.apply(this._wrapped,arguments),this._chain)}}),E.prototype.chain=function(){return this._chain=!0,this},E.prototype.value=function(){return this._wrapped}})).call(this)}),require.define("/Fen.js",function(a,b,c,d,e){var f=a("underscore"),g=function(a){this.pieces={},this.activeColor=null,this._parse(a||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")};g.prototype.move=function(a,b){this._validateMove(a,b),this._updateActiveColor(),this._updateCastling(a),this._updateEnPassant(a,b),this._updateHalfmoveClock(a,b),this._updateFullmoveNumber(),this._updatePiecePlacement(a,b)},g.prototype.canCastle=function(a){return f.include(this.castling,a)},g.prototype._validateMove=function(a,b){var c=this.pieces[a];if(!c)throw new Error("You must select a valid piece to move: "+a)},g.prototype._updateFullmoveNumber=function(){this.activeColor=="w"&&this.fullmove++},g.prototype._updateHalfmoveClock=function(a,b){var c=this.pieces[a];this._isPawn(c)||this.pieces[b]?this.halfmove=0:this.halfmove++},g.prototype._updateEnPassant=function(a,b){var c=this.pieces[a];if(this._isPawn(c)){var d=b.charAt(1)-a.charAt(1);if(Math.abs(d)==2){this.enPassant=b.charAt(0)+(parseInt(a.charAt(1),10)+d/2);return}}this.enPassant="-"},g.prototype._updateCastling=function(a){if(!this.castling.length)return!1;switch(a){case"a1":this.castling=f.without(this.castling,"Q");break;case"a8":this.castling=f.without(this.castling,"q");break;case"h1":this.castling=f.without(this.castling,"K");break;case"h8":this.castling=f.without(this.castling,"k");break;case"e1":this.castling=f.without(this.castling,"Q","K");break;case"e8":this.castling=f.without(this.castling,"q","k")}},g.prototype._updatePiecePlacement=function(a,b){var c=this.pieces[a];delete this.pieces[a],this.pieces[b]=c},g.prototype._updateActiveColor=function(){this.activeColor=this.activeColor=="w"?"b":"w"},g.prototype._isPawn=function(a){return a=="p"||a=="P"},g.prototype._parse=function(a){var b=a.split?a.split(" "):[];if(!b||b.length!=6)throw new Error("A FEN must contain 6 space separated fields: "+a);this._parsePiecePlacement(b[0]),this._parseActiveColor(b[1]),this._parseCastling(b[2]),this._parseEnPassant(b[3]),this._parseHalfmoveClock(b[4]),this._parseFullmoveNumber(b[5])},g.prototype._parsePiecePlacement=function(a){var b=a.split("/");if(b.length!=8)throw new Error("A FEN must contain 8 ranks separated by /: "+a);var c="abcdefgh",d="87654321";f.each(b,function(a,b){var e=0;f.each(a.split(""),function(a,f){if(!a.match(/[0-8]/)){var g=c.charAt(e)+d.charAt(b);this.pieces[g]=a,e++}else e+=parseInt(a,10)},this)},this)},g.prototype._parseActiveColor=function(a){if(a=="w"||a=="b")this.activeColor=a;else throw new Exception("Illegal active color: "+a)},g.prototype._parseCastling=function(a){if(a.match(/[wqWQ\-].*/))this.castling=a.split("");else throw new Exception("Illegal castling string: "+a)},g.prototype._parseEnPassant=function(a){this.enPassant=a},g.prototype._parseHalfmoveClock=function(a){this.halfmove=parseInt(a,10)},g.prototype._parseFullmoveNumber=function(a){this.fullmove=parseInt(a,10)},c.Fen=g}),require.define("/PieceFactory.js",function(a,b,c,d,e){var f=a("./Pawn").Pawn,g=a("./King").King,h=a("./Rook").Rook,i=a("./Knight").Knight,j=a("./Bishop").Bishop,k=a("./Queen").Queen,l={PAWN:1,KNIGHT:2,KING:3,BISHOP:5,ROOK:6,QUEEN:7,WHITE:1,BLACK:-1},m=function(){var a=[null,f,i,g,null,j,h,k],b={r:l.BLACK*l.ROOK,n:l.BLACK*l.KNIGHT,b:l.BLACK*l.BISHOP,q:l.BLACK*l.QUEEN,k:l.BLACK*l.KING,p:l.BLACK*l.PAWN,R:l.WHITE*l.ROOK,N:l.WHITE*l.KNIGHT,B:l.WHITE*l.BISHOP,Q:l.WHITE*l.QUEEN,K:l.WHITE*l.KING,P:l.WHITE*l.PAWN};return{create:function(c,d,e){var f=b[c],g=f>0?l.WHITE:l.BLACK,h=a[Math.abs(f)];return h?new h(d,g,e):{}}}}();c.PieceFactory=m}),require.define("/Pawn.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.moves=[],this.type=1};h.prototype=new g,h.prototype.calculate=function(){this.moves=[],this.checks=[],this.attacks=[],this.pinning={},this.behindKing=null,this._addRegularMoves(),this._addCaptureMoves(),this._removePinnedMoves(),this._removeMovesNotHelpingCheckedKing()},h.prototype.canCaptureEnPassant=function(a){return this.board.isEnPassant(a)},h.prototype._addRegularMoves=function(){var a=this.idx+this.color*16;if(this.board.isOnBoard(a)&&this.board.isEmpty(a)){this.moves.push(a);if(this.color==1&&this.idx>=16&&this.idx<24||this.color==-1&&this.idx>=96&&this.idx<104)a=this.idx+this.color*32,this.board.isEmpty(a)&&this.moves.push(a)}},h.prototype._addCaptureMoves=function(){f.each(this._CAPTURE_DIRECTIONS,function(a){var b=this.idx+this.color*16+a;(this.canCapture(b)||this.canCaptureEnPassant(b))&&this.moves.push(b);if(this.canCapture(b)){var c=this.board._getPieceAt(b);c.color!=this.color&&c.type==3&&(this.checks=[this.idx])}this.board.isOnBoard(b)&&this.attacks.push(b)},this)},h.prototype._CAPTURE_DIRECTIONS=[1,-1],c.Pawn=h}),require.define("/Piece.js",function(a,b,c,d,e){var f=a("underscore"),g=function(){this.attacks=[]};g.prototype.canCapture=function(a){var b=this.board._getPieceAt(a);return b&&b.color!=this.color},g.prototype.canMoveTo=function(a){var b=this.board._getPieceAt(a);return!b&&this.board.isOnBoard(a)},g.prototype.addDirectionalMoves=function(a){this.moves=[],this.checks=[],this.attacks=[],this.pinning={},this.behindKing=null,f.each(a,function(a){this._addNextDirectionalMove(a)},this),this._removePinnedMoves(),this._removeMovesNotHelpingCheckedKing()},g.prototype._removePinnedMoves=function(){if(this.color==this.board._getCurrentColor()){var a=this.board.isPinned(this.idx);a&&(this.moves=f.intersect(this.moves,a))}},g.prototype._addNextDirectionalMove=function(a,b){b=b||1;var c=this.idx+b*a;this.canMoveTo(c)?(this.moves.push(c),this.attacks.push(c),this._addNextDirectionalMove(a,++b)):(this.canCapture(c)&&(this.moves.push(c),this._checkPinning(c,a,b),this._checkKingAttacks(c,a,b)),this.board.isOnBoard(c)&&this.attacks.push(c))},g.prototype._removeMovesNotHelpingCheckedKing=function(){if(this.color==this.board._getCurrentColor()){var a=this.board.getCheckingPieces();a.length==1?this.moves=f.intersect(this.moves,a[0].checks):a.length>1&&(this.moves=[])}},g.prototype._checkKingAttacks=function(a,b,c){var d=this.board._getPieceAt(a);d.type==3&&(this.checks=[],this._setMoveBehindKing(b,c),this._backtrackPinnedMoves(b,--c,this.checks))},g.prototype._checkPinning=function(a,b,c){var d=this.idx+(c+1)*b;if(this.canMoveTo(d))this._checkPinning(a,b,++c);else if(this.canCapture(d)){var e=this.board._getPieceAt(d);e.type==3&&e.color!=this.color&&(this.pinning[a]=[],this._backtrackPinnedMoves(b,c,this.pinning[a]))}},g.prototype._setMoveBehindKing=function(a,b){var c=this.idx+(b+1)*a;this.canMoveTo(c)&&(this.behindKing=c)},g.prototype._backtrackPinnedMoves=function(a,b,c){var d=this.idx+b*a;c.push(d),d!=this.idx&&this._backtrackPinnedMoves(a,--b,c)},c.Piece=g}),require.define("/King.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.type=3,this.moves=[],this.attacks=[],this.behindKing=null,this._castlingIdx=this.color==1?4:116,this._castling=this.color==1?{Q:-1,K:1}:{q:-1,k:1}};h.prototype=new g,h.prototype.calculate=function(){this.moves=[],this.checks=[],this.attacks=[],this.pinning={},this._addRegularMoves(),this._addCastlingMoves()},h.prototype.canCastle=function(a,b){var c=this.idx==this._castlingIdx&&this.board.canCastle(a);return c?!this._pathToRookIsBlocked(a):!1},h.prototype._pathToRookIsBlocked=function(a){return f.find(this.CASTLE_SQUARES[a.toLowerCase()],function(a){var b=this.idx+a;return!this.canMoveTo(b)||this.isAttacked(b)},this)},h.prototype.isAttacked=function(a){return this.board.isAttacked(a)},h.prototype.isProtected=function(a){return this.board.isProtected(a)},h.prototype._addRegularMoves=function(){f.each(this.DIRECTIONS,function(a){var b=this.idx+a;!this.isSquareBehindCheckedKing(b)&&(this.canMoveTo(b)&&!this.isAttacked(b)||this.canCapture(b)&&!this.isProtected(b))&&this.moves.push(b),this.board.isOnBoard(b)&&this.attacks.push(b)},this)},h.prototype.isSquareBehindCheckedKing=function(a){var b=this.board._getCurrentColor();return f.detect(this.board._getPieces(b*-1),function(b){return b.behindKing==a})},h.prototype._addCastlingMoves=function(){f.each(this._castling,function(a,b){this.canCastle(b)&&this.moves.push(this.idx+a*2)},this)},h.prototype.CASTLE_SQUARES={q:[-1,-2,-3],k:[1,2]},h.prototype.DIRECTIONS=[-1,1,15,16,17,-17,-16,-15],c.King=h}),require.define("/Rook.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.moves=[]};h.prototype=new g,h.prototype.calculate=function(){this.addDirectionalMoves(this.DIRECTIONS)},h.prototype.DIRECTIONS=[1,-1,16,-16],c.Rook=h}),require.define("/Knight.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.moves=[]};h.prototype=new g,h.prototype.calculate=function(){this.moves=[],this.checks=[],this.attacks=[],this.pinning={},this.behindKing=null,this._addRegularMoves(),this._removePinnedMoves(),this._removeMovesNotHelpingCheckedKing()},h.prototype._addRegularMoves=function(){f.each(this.DIRECTIONS,function(a){var b=this.idx+a;(this.canMoveTo(b)||this.canCapture(b))&&this.moves.push(b);if(this.canCapture(b)){var c=this.board._getPieceAt(b);c.color!=this.color&&c.type==3&&(this.checks=[this.idx])}this.board.isOnBoard(b)&&this.attacks.push(b)},this)},h.prototype.DIRECTIONS=[14,18,31,33,-18,-14,-33,-31],c.Knight=h}),require.define("/Bishop.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.moves=[]};h.prototype=new g,h.prototype.calculate=function(){this.addDirectionalMoves(this.OFFSETS)},h.prototype.OFFSETS=[15,17,-17,-15],c.Bishop=h}),require.define("/Queen.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Piece").Piece,h=function(a,b,c){this.idx=a,this.color=b,this.board=c,this.moves=[]};h.prototype=new g,h.prototype.calculate=function(){this.addDirectionalMoves(this.OFFSETS)},h.prototype.OFFSETS=[-1,1,15,16,17,-17,-16,-15],c.Queen=h}),require.define("/Board.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./Fen").Fen,h=a("./PieceFactory").PieceFactory,i=function(a){this._fen=new g(a),this._board=new Array(128),f.each(this._fen.pieces,function(a,b){var c=this._posToIdx(b);this._board[c]=h.create(a,c,this)},this),this._calculate()};i.prototype={WHITE:1,BLACK:-1,_files:"abcdefgh",move:function(a,b){var c=this._getPiece(a);if(!c)throw"there is no piece to move";if(this._getCurrentColor()!=c.color)throw"cannot move out of order";var d=this._posToIdx(b);if(c.moves.indexOf(d)==-1)throw"illegal move";if(c.type==1&&(d<9||d>111)&&c.canMoveTo(d))return this._fen.move(a,b),this._updateArray(a,b),this._board[d]=h.create(c.color=="1"?"Q":"q",d,this),this._calculate(),{status:"promotion"};if(c&&(c.canCapture(d)||c.canMoveTo(d)))return this._fen.move(a,b),this._updateArray(a,b),this._calculate(),{status:"move"};throw"unable to move from "+a+" to "+b},_posToIdx:function(a){if(!a||typeof a!="string"||!a.match(/[a-h]{1}[0-8]{1}/))throw"illegal pos "+a;var b=this._files.indexOf(a[0]);return b+(a[1]-1)*16},_idxToPos:function(a){var b=a%16,c=Math.floor(a/16),d=this._files[b]+(c+1);if(typeof d!="string")throw"illegal idx "+a;return d},_getPieceAt:function(a){return this._board[a]},_getPieces:function(a){return f.filter(this._board,function(b){return a?b&&b.color==a:b})},_getPiece:function(a){var b=this._posToIdx(a);return this._getPieceAt(b)},_getCurrentColor:function(){return this._fen.activeColor=="w"?this.WHITE:this.BLACK},_calculate:function(){var a=this._getCurrentColor();f.each(this._getPieces(a*-1),function(a){a.calculate()}),f.each(this._getPieces(a),function(a){a.calculate()})},_updateArray:function(a,b){var c=this._posToIdx(a),d=this._board[c];this._board[c]=null;var e=this._posToIdx(b);d.idx=e,this._board[e]=d},getCheckingPieces:function(){var a=this._getCurrentColor(),b=this._getPieces(a*-1);return f.filter(b,function(a){return a.checks&&a.checks.length>0})},isPinned:function(a){var b=this._getCurrentColor(),c=this._getPieces(b*-1),d=f.detect(c,function(b){return b.pinning&&b.pinning[a]});if(d)return f(d.pinning[a]).chain().clone().without(a).union(d.idx).value()},isAttacked:function(a){var b=this._getCurrentColor();return f.detect(this._getPieces(b*-1),function(b){return b.attacks.indexOf(a)!=-1})},isProtected:function(a){var b=this._getCurrentColor();return f.detect(this._getPieces(b*-1),function(b){return b.moves.indexOf(a)!=-1||b.attacks.indexOf(a)!=-1})},isEmpty:function(a){return!this._getPieceAt(a)},isOnBoard:function(a){return a>=0&&a<127&&(a&136)===0},canCastle:function(a){return this._fen.canCastle(a)},isEnPassant:function(a){var b=this._fen.enPassant;if(b&&b!="-"){var c=this._posToIdx(b);return a==c}return!1},getMoves:function(a){var b=this._posToIdx(a),c=this._getPieceAt(b);return c&&c.color==this._getCurrentColor()?f.map(c.moves,function(a){return this._idxToPos(a)},this):[]}},c.Board=i}),require("/Board.js");